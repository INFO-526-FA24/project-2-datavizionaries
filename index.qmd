---
title: "MindScope: Unveiling Patterns in Mental Health through Data-Driven Insights"
subtitle: ""
author: 
  - name: "Team Data Vizionaries"
    affiliations:
      - name: "College of Information Science, University of Arizona"
description: "Project 2 for INFO 526 course instructed by Prof. Anna Leach"
format:
  html:
    code-tools: true
    code-overflow: wrap
    code-line-numbers: false
    embed-resources: true
editor: visual
code-annotations: hover
execute:
  warning: false
---

```{r}
#| label: load-packages
#| include: true

pacman::p_load(tidymodels, dplyr, readr, tidyverse, here, patchwork,
               readxl, ggplot2, ggimage, GGally, viridis, reshape2, kableExtra)

```

## Abstract

We explore global mental health. There is never too much awareness on a vital topic like this.

## Introduction

::: {style="text-align: justify;"}
This project uses the ‘Mental Health Dataset’ sourced from Kaggle. It was prepared by Mr Bhavik Jikdara by extracting the required information from `<a href="`{=html}<https://ourworldindata.org/mental-health/>`" target="_blank">`{=html}Our World in Data</a> . The dataset contains a variety of features related to text analysis, psychological indicators, stress, isolation and behavioral attributes making it suitable to visualize and get insights into mental health. The data covers the time period between August 2014 and February 2016.

The dataset has a total of 17 columns: 1 datetime and 16 categorical variables. The categorical columns: Gender, Country, Occupation, self_employed, family_history, treatment, Days_Indoors, Growing_Stress, Changes_Habits, Mental_Health_History, Mood_Swings, Coping_Struggles, Work_Interest, Social_Weakness, mental_health_interview, care_options and the datetime column: Timestamp are both represented by the character data type in R. The dataset has 292364 entries and 17 columns indicating it has a dimension of 292364 x 17. The description of the columns is as follows:
:::

| **Column Name** | **Class** | **Description** |
|----|----|----|
| Timestamp | character(datetime) | The timestamp at which an observation was recorded |
| Gender | character | Gender of the person(Male or Female) |
| Country | character | Country to which the person belongs to |
| Occupation | character | The occupation of the person |
| self_employed | character | Indicates whether the person works from themselves, has their own business(Yes or No) |
| family_history | character | History of mental health issues among family members(Yes or No) |
| treatment | character | Indicates whether a person is taking treatment for mental health issues. (Yes or No) |
| Days_Indoor | character |  |
| Growing_Stress | character | Indicates whether a person's stress level is increasing over time. (Yes or No) |
| Changes_Habits | character | It refers to changes in behavior or habits that may indicate shifts in mental health. |
| Mental_Health_History | character | Person’s mental health history |
| Mood_Swings | character | Fluctuations in a person's mood |
| Coping_Struggles | character | Difficulties a person may have in coping with mental health challenges. |
| Work_Interest | character | Indicates whether interested in doing work or not |
| Social_Weakness | character | Indicates difficulties in social interactions or relationships |
| mental_health_interview | character | Indicates whether the person would bring up the issue of mental health with potential employer in an interview |
| care_options | character | Indicates whether options are available for treatment of mental health issues, such as therapy, medication, or support groups. |

## Question 1: How family history affect mental health

<div style="text-align:justify;">

What correlations exist between coping difficulties, social weakness, and work interest in occupation and self-employment status? Does a person's or their family's history of mental health problems link with higher levels of mood swings, coping challenges and social fragility?

</div>

## Approach

::: {style="text-align: justify;"}
Few lines about how we approach this question
:::

## Analysis

```{r}
# List of required packages
required_packages <- c("tidyverse", "skimr", "readr", "dplyr", "countrycode", "patchwork", 
                       "ggplot2", "ggiraph", "sf", "gganimate", "gridExtra","transformr","corrplot","tidyr","reshape2")

# Function to check if a package is installed; if not, install it
install_if_missing <- function(pkg) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    message(paste("Installing package:", pkg))
    install.packages(pkg, dependencies = TRUE)
  } else {
    message(paste("Package", pkg, "is already installed"))
  }
}

# Apply the function to each package
invisible(lapply(required_packages, install_if_missing))

# Function to load all the required packages
load_packages <- function(pkg_list) {
  invisible(lapply(pkg_list, function(pkg) {
    library(pkg, character.only = TRUE)
  }))
}

load_packages(required_packages)
```

```{r}
# Load required libraries
library(dplyr)
library(readr)
library(ggplot2)
library(reshape2)
library(viridis)

# Read the data
df <- read_csv("./data/mental_health.csv")

# Convert column names to lowercase and replace spaces with underscores
names(df) <- tolower(names(df))
names(df) <- gsub(" ","_", names(df))

# Create a smaller dataframe with just the four variables of interest
df_selected <- data.frame(
  coping_struggles = ifelse(df$coping_struggles == "Yes", 1, 0),
  social_weakness = case_when(
    df$social_weakness == "Yes" ~ 2,
    df$social_weakness == "Maybe" ~ 1,
    df$social_weakness == "No" ~ 0
  ),
  work_interest = ifelse(df$work_interest == "Yes", 1, 0),
  self_employed = ifelse(df$self_employed == "Yes", 1, 0)
)

# Calculate correlation matrix
cor_matrix <- cor(df_selected, use = "complete.obs")

# Rename variables for multi-line labels  
colnames(cor_matrix) <- c("Coping\nStruggles", "Social\nWeakness", "Work\nInterest", "Self\nEmployed")  
rownames(cor_matrix) <- c("Coping\nStruggles", "Social\nWeakness", "Work\nInterest", "Self\nEmployed") 

# Melt the correlation matrix for ggplot
cor_melted <- reshape2::melt(cor_matrix)

# Keep only upper triangle of the correlation matrix  
cor_melted <- cor_melted[which(as.integer(cor_melted$Var1) <= as.integer(cor_melted$Var2)), ]  

# Create correlation plot
cor_plot <- ggplot(cor_melted, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  geom_text(aes(label = sprintf("%.2f", value)), 
            #color = ifelse(abs(cor_melted$value) > 0.5, "white", "black"), 
            size = 4) +
  # scale_fill_viridis(
  #   option = "viridis",
  #   limits = c(-1, 1),
  #   name = "Correlation"
  # ) +
  scale_fill_gradient(low = "#c8ac7d", high = "#555ba5")+
  theme_minimal() +
  theme(
    #axis.text.x = element_text(hjust = 1, size = 10, angle=90),
    axis.text.x = element_text(size=10),
    axis.text.y = element_text(size = 10),
    axis.title = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    plot.title = element_text(hjust = 0.5, size = 14),
    legend.title = element_blank(),
  ) +
  ggtitle("Correlation Matrix of Mental Health Factors") +
  coord_fixed()

# Display the plot
(cor_plot)

# Save the plot
ggsave("./images/new_selected_correlations.png", cor_plot, 
       width = 8, height = 6, dpi = 500)
```

<p style="text-align:justify">

The image shows a correlation matrix heatmap between the four mental-health related variables: coping_struggles, social_weakness, work_interest and self_employed. The matrix uses a color schema ranging from yellow(1.0) to teal(0). Looking at the specific correlations, we can observe that each variable has perfect positive correlation(1.00) with itself, shown in yellow along the diagonal. However, the relationship between different variables is significantly weak or non-existent with values very close to zero. For instance, work_interest and social_weakness show a very slight negative correlation of -0.05, while coping_struggles and social_weakness have a minimal positive correlation of 0.01. The variable self-employed shows no correlation with any other factors. These observations indicate that these mental health factors are independent of each other.

</p>

```{r}

data <- read.csv("data/mental_health.csv")

encode_ordinal <- function(x, order = unique(x)) {
  x <- as.numeric(factor(x, levels = order, exclude = NULL))
  x
}

data$Mood_Swings <- encode_ordinal(data$Mood_Swings, order = c("Low", "Medium", "High"))
data$Coping_Struggles <- encode_ordinal(data$Coping_Struggles, order = c("No", "Maybe", "Yes"))
data$Social_Weakness <- encode_ordinal(data$Social_Weakness, order = c("No", "Maybe", "Yes"))
data$Work_Interest <- encode_ordinal(data$Work_Interest, order = c("No", "Maybe", "Yes"))

summary_data <- data %>%
  group_by(Gender, family_history) %>%
  summarise(Average_Coping_Struggles = mean(Coping_Struggles), .groups = "drop")

coping_struggles <- ggplot(summary_data, aes(x = Gender, y = Average_Coping_Struggles, fill = family_history)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  scale_fill_manual(values = c("Yes" = "#ccad80", "No" = "#535aa3")) +
  labs(
    title = "Coping Struggles",
    x = "Gender",
    y = "Coping Struggles",
    fill = "Family History"
  ) +
  theme_minimal()

coping_struggles
```

```{r}
#| label: q1-2
#| include: true

summary_data <- data %>%
  group_by(Gender, family_history) %>%
  summarise(Average_Social_Weakness = mean(Social_Weakness), .groups = "drop")

social_weakness <- ggplot(summary_data, aes(x = Gender, y = Average_Social_Weakness, fill = family_history)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  scale_fill_manual(values = c("Yes" = "#ccad80", "No" = "#535aa3")) +
  labs(
    title = "Social Weakness",
    x = "Gender",
    y = "Social Weakness",
    fill = "Family History"
  ) +
  theme_minimal()

social_weakness
```

```{r}
#| label: q1-3
#| include: true

summary_data <- data %>%
  group_by(Gender, family_history) %>%
  summarise(Average_Work_Interest = mean(Work_Interest), .groups = "drop")

work_interest <- ggplot(summary_data, aes(x = Gender, y = Average_Work_Interest, fill = family_history)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  scale_fill_manual(values = c("Yes" = "#ccad80", "No" = "#535aa3")) +
  labs(
    title = "Work Interest",
    x = "Gender",
    y = "Work Interest",
    fill = "Family History"
  ) +
  theme_minimal()

work_interest
```

```{r}
#| label: q1-4
#| include: true
summary_data <- data %>%
  group_by(Gender, family_history) %>%
  summarise(Average_Mood_Swings = mean(Mood_Swings), .groups = "drop")

mood_swings <- ggplot(summary_data, aes(x = Gender, y = Average_Mood_Swings, fill = family_history)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  scale_fill_manual(values = c("Yes" = "#ccad80", "No" = "#535aa3")) +
  labs(
    title = "Mood Swings",
    x = "Gender",
    y = "Mood Swings",
    fill = "Family History"
  ) +
  theme_minimal()
combined_plot <- (mood_swings + coping_struggles) / (work_interest + social_weakness)
print(combined_plot)
```

```{r}

#| label: q1-4 
#| include: true

ggsave("./images/combined_plot.png", dpi=500)
```
